---
import { actions } from 'astro:actions'
import Layout from '@layouts/Layout.astro'
import DraftTag from '@components/DraftTag.astro'
import Date from '@components/Date.astro'

const { id } = Astro.params

if (id === undefined) {
  throw new Error('The post could not be found')
}

const result = await Astro.callAction(actions.posts.get, { id })

if (result.error) {
  throw new Error(result.error.message)
}

const post = result.data
---

<Layout title={post.title}>
  <main class="flex flex-col items-center gap-8 p-4">
    <header>
      <h1 class="mb-2 text-4xl font-bold">{post.title}</h1>
      <div class="flex items-center gap-2">
        <Date date={post.createdAt} />
        {post.isDraft && <DraftTag />}
      </div>
    </header>
    <div class="prose">
      <Fragment set:html={post.content} />
    </div>
  </main>
</Layout>
