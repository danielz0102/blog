---
import { actions } from 'astro:actions'
import Layout from '@layouts/Layout.astro'
import PostInfo from '@components/PostInfo.astro'

const { id } = Astro.params

if (id === undefined) {
  throw new Error('The post could not be found')
}

const result = await Astro.callAction(actions.posts.get, { id })

if (result.error) {
  throw new Error(result.error.message)
}

const post = result.data
---

<Layout title={post.title}>
  <main class="flex flex-col gap-8 self-center p-4">
    <header class="prose">
      <h1 class="mb-1 text-4xl font-bold">{post.title}</h1>
      <PostInfo post={post} />
    </header>
    <div class="prose">
      <Fragment set:html={post.content} />
    </div>
  </main>
</Layout>
